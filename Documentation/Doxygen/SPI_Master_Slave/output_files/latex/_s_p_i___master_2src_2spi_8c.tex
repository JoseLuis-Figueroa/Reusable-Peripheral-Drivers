\doxysection{C\+:/\+Users/\+User/\+One\+Drive/\+Documents/1.Repositories/\+Embedded\+Systems/\+STM32/\+Reusable-\/\+Drivers/\+SPI\+\_\+\+Master/src/spi.c File Reference}
\hypertarget{_s_p_i___master_2src_2spi_8c}{}\label{_s_p_i___master_2src_2spi_8c}\index{C:/Users/User/OneDrive/Documents/1.Repositories/EmbeddedSystems/STM32/Reusable-\/Drivers/SPI\_Master/src/spi.c@{C:/Users/User/OneDrive/Documents/1.Repositories/EmbeddedSystems/STM32/Reusable-\/Drivers/SPI\_Master/src/spi.c}}


The implementation for the SPI Driver.  


{\ttfamily \#include "{}spi.\+h"{}}\newline
Include dependency graph for spi.\+c\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=263pt]{_s_p_i___master_2src_2spi_8c__incl}
\end{center}
\end{figure}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{_s_p_i___master_2src_2spi_8c_a1c60b9b5ccb0c9730a8203bc50f51512}{SPI\+\_\+init}} (const \mbox{\hyperlink{struct_spi_config__t}{Spi\+Config\+\_\+t}} \texorpdfstring{$\ast$}{*}const Config, size\+\_\+t config\+Size)
\item 
void \mbox{\hyperlink{_s_p_i___master_2src_2spi_8c_a4eb5e4456aade25edc6c6f4b673ddeda}{SPI\+\_\+transfer}} (const \mbox{\hyperlink{struct_spi_transfer_config__t}{Spi\+Transfer\+Config\+\_\+t}} \texorpdfstring{$\ast$}{*}const Transfer\+Config)
\item 
void \mbox{\hyperlink{_s_p_i___master_2src_2spi_8c_a7720b57a48f8aa6dc2e928d42397fdea}{SPI\+\_\+receive}} (const \mbox{\hyperlink{struct_spi_transfer_config__t}{Spi\+Transfer\+Config\+\_\+t}} \texorpdfstring{$\ast$}{*}const Transfer\+Config)
\item 
void \mbox{\hyperlink{_s_p_i___master_2src_2spi_8c_aa37a28f7826d2b06a5150c5e92e686ae}{SPI\+\_\+register\+Write}} (uint32\+\_\+t address, uint32\+\_\+t value)
\item 
uint16\+\_\+t \mbox{\hyperlink{_s_p_i___master_2src_2spi_8c_a03822429df04dacaaae2f7682a3f6956}{SPI\+\_\+register\+Read}} (uint32\+\_\+t address)
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
The implementation for the SPI Driver. 

\begin{DoxyAuthor}{Author}
Jose Luis Figueroa 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+1 
\end{DoxyVersion}
\begin{DoxyDate}{Date}
2025-\/03-\/11
\end{DoxyDate}
\begin{DoxyCopyright}{Copyright}
Copyright (c) 2025 Jose Luis Figueroa. MIT License. 
\end{DoxyCopyright}


\doxysubsection{Function Documentation}
\Hypertarget{_s_p_i___master_2src_2spi_8c_a1c60b9b5ccb0c9730a8203bc50f51512}\index{spi.c@{spi.c}!SPI\_init@{SPI\_init}}
\index{SPI\_init@{SPI\_init}!spi.c@{spi.c}}
\doxysubsubsection{\texorpdfstring{SPI\_init()}{SPI\_init()}}
{\footnotesize\ttfamily \label{_s_p_i___master_2src_2spi_8c_a1c60b9b5ccb0c9730a8203bc50f51512} 
void SPI\+\_\+init (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{struct_spi_config__t}{Spi\+Config\+\_\+t}} \texorpdfstring{$\ast$}{*}const}]{Config}{, }\item[{size\+\_\+t}]{config\+Size}{}\end{DoxyParamCaption})}

{\bfseries{Description\+:}} This function is used to initialize the SPI based on the configuration ~\newline
 table defined in spi\+\_\+cfg module.

PRE-\/\+CONDITION\+: The MCU clocks must be configured and enabled. ~\newline
 PRE-\/\+CONDITION\+: SPI pins should be configured using GPIO driver. ~\newline
 PRE-\/\+CONDITION\+: Configuration table needs to be populated (sizeof \texorpdfstring{$>$}{>} 0) ~\newline
 PRE-\/\+CONDITION\+: The setting is within the maximum values (SPI\+\_\+\+MAX). ~\newline


POST-\/\+CONDITION\+: The peripheral is set up with the configuration settings. ~\newline



\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em Config} & is a pointer to the configuration table that contains the initialization for the peripheral. \\
\hline
\mbox{\texttt{ in}}  & {\em config\+Size} & is the size of the configuration table.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void
\end{DoxyReturn}
{\bfseries{Example\+:}} 
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{const}\ \mbox{\hyperlink{struct_spi_config__t}{SpiConfig\_t}}\ *\ \textcolor{keyword}{const}\ \mbox{\hyperlink{_s_p_i___master_2src_2spi__cfg_8c_a19dbdd2a49e995603d1f6506823d2f84}{SpiConfig}}\ =\ SPI\_configGet();}
\DoxyCodeLine{\textcolor{keywordtype}{size\_t}\ configSize\ =\ \mbox{\hyperlink{_s_p_i___master_2src_2spi__cfg_8c_a52c2bcd5d6de69c68453237ffc72e724}{SPI\_configSizeGet}}();}
\DoxyCodeLine{}
\DoxyCodeLine{SPI\_Init(\mbox{\hyperlink{_s_p_i___master_2src_2dio__cfg_8c_ad606ed583fbec9d0749c319c717a65f1}{DioConfig}},\ configSize);}

\end{DoxyCode}


\begin{DoxySeeAlso}{See also}
SPI\+\_\+config\+Get 

SPI\+\_\+get\+Config\+Size 

SPI\+\_\+\+Init 

SPI\+\_\+\+Transfer 

SPI\+\_\+\+Register\+Write 

SPI\+\_\+\+Register\+Read 

SPI\+\_\+\+Callback\+Register 
\end{DoxySeeAlso}
Loop through all the elements of the configuration table.

Set the configuration of the SPI on the control register 1

Set the Clock phase and polarity modes

Set the hierarchy of the device

Set the baud rate of the device

Set the slave select pin management for the device

Set the frame format of the device

Set the data transfer type of the device

Set the data frame format (size) of the device

Enable the SPI module\Hypertarget{_s_p_i___master_2src_2spi_8c_a7720b57a48f8aa6dc2e928d42397fdea}\index{spi.c@{spi.c}!SPI\_receive@{SPI\_receive}}
\index{SPI\_receive@{SPI\_receive}!spi.c@{spi.c}}
\doxysubsubsection{\texorpdfstring{SPI\_receive()}{SPI\_receive()}}
{\footnotesize\ttfamily \label{_s_p_i___master_2src_2spi_8c_a7720b57a48f8aa6dc2e928d42397fdea} 
void SPI\+\_\+receive (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{struct_spi_transfer_config__t}{Spi\+Transfer\+Config\+\_\+t}} \texorpdfstring{$\ast$}{*}const}]{Transfer\+Config}{}\end{DoxyParamCaption})}

{\bfseries{Description\+:}} This function is used to initialize a data reception on the SPI bus. This function is used to receive data specified by the \doxylink{struct_spi_transfer_config__t}{Spi\+Transfer\+Config\+\_\+t} structure, which contains the channel, size, and data.

PRE-\/\+CONDITION\+: The MCU clocks must be configured and enabled. ~\newline
 PRE-\/\+CONDITION\+: SPI\+\_\+\+Init must be called with valid configuration data. ~\newline
 PRE-\/\+CONDITION\+: \doxylink{struct_spi_transfer_config__t}{Spi\+Transfer\+Config\+\_\+t} needs to be populated. ~\newline
 PRE-\/\+CONDITION\+: The Channel is within the maximum \doxylink{_s_p_i___master_2include_2spi__cfg_8h_a8ed88c83798d221d2afb7ab8b4023faa}{Spi\+Channel\+\_\+t}. ~\newline
 PRE-\/\+CONDITION\+: The size is greater than 0. ~\newline
 PRE-\/\+CONDITION\+: The data is not NULL. ~\newline


POST-\/\+CONDITION\+: Data transferred based on configuration.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em Spi\+Transfer\+Config} & A pointer to a structure containing the channel, size, and data to be read.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void
\end{DoxyReturn}
{\bfseries{Example\+:}} 
\begin{DoxyCode}{0}
\DoxyCodeLine{uint16\_t\ rxdata[1];}
\DoxyCodeLine{\ \mbox{\hyperlink{struct_spi_transfer_config__t}{SpiTransferConfig\_t}}\ ReceiveConfig\ =}
\DoxyCodeLine{\ \{}
\DoxyCodeLine{\ \ \ \ \ .Channel\ =\ \mbox{\hyperlink{_s_p_i___master_2include_2spi__cfg_8h_a8ed88c83798d221d2afb7ab8b4023faaae01f25f2493c2b0a1406ee1371a2752d}{SPI\_CHANNEL1}},}
\DoxyCodeLine{\ \ \ \ \ .size\ =\ \textcolor{keyword}{sizeof}(rxdata)/\textcolor{keyword}{sizeof}(rxdata[0]),}
\DoxyCodeLine{\ \ \ \ \ .data\ =\ rxdata}
\DoxyCodeLine{\ \};}
\DoxyCodeLine{\ \mbox{\hyperlink{_s_p_i___master_2src_2spi_8c_a7720b57a48f8aa6dc2e928d42397fdea}{SPI\_receive}}(\&ReceiveConfig);}

\end{DoxyCode}


\begin{DoxySeeAlso}{See also}
SPI\+\_\+config\+Get 

SPI\+\_\+get\+Config\+Size 

SPI\+\_\+\+Init 

SPI\+\_\+\+Transfer 

SPI\+\_\+\+Register\+Write 

SPI\+\_\+\+Register\+Read 

SPI\+\_\+\+Callback\+Register 
\end{DoxySeeAlso}
\Hypertarget{_s_p_i___master_2src_2spi_8c_a03822429df04dacaaae2f7682a3f6956}\index{spi.c@{spi.c}!SPI\_registerRead@{SPI\_registerRead}}
\index{SPI\_registerRead@{SPI\_registerRead}!spi.c@{spi.c}}
\doxysubsubsection{\texorpdfstring{SPI\_registerRead()}{SPI\_registerRead()}}
{\footnotesize\ttfamily \label{_s_p_i___master_2src_2spi_8c_a03822429df04dacaaae2f7682a3f6956} 
uint16\+\_\+t SPI\+\_\+register\+Read (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{address}{}\end{DoxyParamCaption})}

{\bfseries{Description\+:}} This function is used to directly address a SPI register. The function should be used to access specialized functionality in the SPI peripheral that is not exposed by any other function of the interface.

PRE-\/\+CONDITION\+: Address is within the boundaries of the SPI register address space. ~\newline


POST-\/\+CONDITION\+: The value stored in the register is returned to the caller. ~\newline



\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em address} & is the address of the SPI register to read.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The current value of the SPI register.
\end{DoxyReturn}
{\bfseries{Example\+:}} 
\begin{DoxyCode}{0}
\DoxyCodeLine{type\ spiValue\ =\ \mbox{\hyperlink{_s_p_i___master_2src_2spi_8c_a03822429df04dacaaae2f7682a3f6956}{SPI\_registerRead}}(0x1000);}

\end{DoxyCode}


\begin{DoxySeeAlso}{See also}
SPI\+\_\+config\+Get 

\doxylink{_s_p_i___master_2src_2spi__cfg_8c_a52c2bcd5d6de69c68453237ffc72e724}{SPI\+\_\+config\+Size\+Get} 

SPI\+\_\+\+Init 

SPI\+\_\+\+Transfer 

SPI\+\_\+\+Register\+Write 

SPI\+\_\+\+Register\+Read 

SPI\+\_\+\+Callback\+Register 
\end{DoxySeeAlso}
\Hypertarget{_s_p_i___master_2src_2spi_8c_aa37a28f7826d2b06a5150c5e92e686ae}\index{spi.c@{spi.c}!SPI\_registerWrite@{SPI\_registerWrite}}
\index{SPI\_registerWrite@{SPI\_registerWrite}!spi.c@{spi.c}}
\doxysubsubsection{\texorpdfstring{SPI\_registerWrite()}{SPI\_registerWrite()}}
{\footnotesize\ttfamily \label{_s_p_i___master_2src_2spi_8c_aa37a28f7826d2b06a5150c5e92e686ae} 
void SPI\+\_\+register\+Write (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{address}{, }\item[{uint32\+\_\+t}]{value}{}\end{DoxyParamCaption})}

{\bfseries{Description\+:}} This function is used to directly address and modify a SPI register. The function should be used to access specialized functionality in the SPI peripheral that is not exposed by any other function of the interface.

PRE-\/\+CONDITION\+: Address is within the boundaries of the SPI register address space. ~\newline


POST-\/\+CONDITION\+: The register located at address with be updated with value. ~\newline



\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em address} & is a register address within the SPI peripheral map. \\
\hline
\mbox{\texttt{ in}}  & {\em value} & is the value to set the SPI register.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void
\end{DoxyReturn}
{\bfseries{Example}} 
\begin{DoxyCode}{0}
\DoxyCodeLine{\mbox{\hyperlink{_s_p_i___master_2src_2spi_8c_aa37a28f7826d2b06a5150c5e92e686ae}{SPI\_registerWrite}}(0x1000,\ 0x15);}

\end{DoxyCode}


\begin{DoxySeeAlso}{See also}
SPI\+\_\+config\+Get 

\doxylink{_s_p_i___master_2src_2spi__cfg_8c_a52c2bcd5d6de69c68453237ffc72e724}{SPI\+\_\+config\+Size\+Get} 

SPI\+\_\+\+Init 

SPI\+\_\+\+Transfer 

SPI\+\_\+\+Register\+Write 

SPI\+\_\+\+Register\+Read 

SPI\+\_\+\+Callback\+Register 
\end{DoxySeeAlso}
\Hypertarget{_s_p_i___master_2src_2spi_8c_a4eb5e4456aade25edc6c6f4b673ddeda}\index{spi.c@{spi.c}!SPI\_transfer@{SPI\_transfer}}
\index{SPI\_transfer@{SPI\_transfer}!spi.c@{spi.c}}
\doxysubsubsection{\texorpdfstring{SPI\_transfer()}{SPI\_transfer()}}
{\footnotesize\ttfamily \label{_s_p_i___master_2src_2spi_8c_a4eb5e4456aade25edc6c6f4b673ddeda} 
void SPI\+\_\+transfer (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{struct_spi_transfer_config__t}{Spi\+Transfer\+Config\+\_\+t}} \texorpdfstring{$\ast$}{*}const}]{Transfer\+Config}{}\end{DoxyParamCaption})}

{\bfseries{Description\+:}} This function is used to initialize a data transfer on the SPI bus. This function is used to send data to a slave device specified by the \doxylink{struct_spi_transfer_config__t}{Spi\+Transfer\+Config\+\_\+t} structure, which contains the channel, size, and data.

PRE-\/\+CONDITION\+: The MCU clocks must be configured and enabled. ~\newline
 PRE-\/\+CONDITION\+: SPI\+\_\+\+Init must be called with valid configuration data. ~\newline
 PRE-\/\+CONDITION\+: \doxylink{struct_spi_transfer_config__t}{Spi\+Transfer\+Config\+\_\+t} needs to be populated. ~\newline
 PRE-\/\+CONDITION\+: The Channel is within the maximum \doxylink{_s_p_i___master_2include_2spi__cfg_8h_a8ed88c83798d221d2afb7ab8b4023faa}{Spi\+Channel\+\_\+t}. ~\newline
 PRE-\/\+CONDITION\+: The size is greater than 0. ~\newline
 PRE-\/\+CONDITION\+: The data is not NULL. ~\newline


POST-\/\+CONDITION\+: Data transferred based on configuration. ~\newline



\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em Spi\+Transfer\+Config} & A pointer to a structure containing the channel, size, and data to be read.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void
\end{DoxyReturn}
{\bfseries{Example\+:}} 
\begin{DoxyCode}{0}
\DoxyCodeLine{uint16\_t\ data[]\ =\ \{0x56\};}
\DoxyCodeLine{\mbox{\hyperlink{struct_spi_transfer_config__t}{SpiTransferConfig\_t}}\ TransferConfig\ =}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ .Channel\ =\ \mbox{\hyperlink{_s_p_i___master_2include_2spi__cfg_8h_a8ed88c83798d221d2afb7ab8b4023faaae01f25f2493c2b0a1406ee1371a2752d}{SPI\_CHANNEL1}},}
\DoxyCodeLine{\ \ \ \ .size\ =\ \textcolor{keyword}{sizeof}(data)/\textcolor{keyword}{sizeof}(data[0]),}
\DoxyCodeLine{\ \ \ \ .data\ =\ data}
\DoxyCodeLine{\};}
\DoxyCodeLine{SPI\_Transfer(\&TransferConfig);}

\end{DoxyCode}


\begin{DoxySeeAlso}{See also}
SPI\+\_\+config\+Get 

SPI\+\_\+get\+Config\+Size 

SPI\+\_\+\+Init 

SPI\+\_\+\+Transfer 

SPI\+\_\+\+Register\+Write 

SPI\+\_\+\+Register\+Read 

SPI\+\_\+\+Callback\+Register 
\end{DoxySeeAlso}
